var GWatch=function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/build/",i(i.s=2)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();t.Utilities=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.logging=!1}return n(e,null,[{key:"log",value:function(){this.logging&&console.log("GWatch: ",[].slice.call(arguments).join(","))}},{key:"notifyError",value:function(e){alert(e)}}]),e}()},function(e,t){e.exports=$},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(3),r=a(i(1)),s=i(6),l=i(0);a(i(7));function a(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config={videoId:t.videoId||"my-video",videoSelector:t.videoSelector||(0,r.default)("#video-selector"),videoSrcElement:t.videoSrcElement||(0,r.default)("#my-video-src"),devmode:t.devmode||!1,socket_server:t.socket_server||window.location.hostname,socket_port:t.socket_port||12345},this.video=null,(0,r.default)("#my-video").show(),this.initializeUIEvents(),l.Utilities.logging=this.config.devmode,l.Utilities.session_identifier=this.generateConnectionId(),l.Utilities.websocket=new s.Socket(this.config.socket_server,this.config.socket_port).websocket}return n(e,[{key:"initializeUIEvents",value:function(){l.Utilities.log("Initializing UI events"),this.config.videoSelector.change(this.onSrcSelected.bind(this))}},{key:"onSrcSelected",value:function(e){var t=e.target.files[0],i=window.URL.createObjectURL(t);l.Utilities.log("New source file selected"),this.changePlayerSource(i)}},{key:"changePlayerSource",value:function(e){l.Utilities.log("Changing player's source"),this.config.videoSrcElement.attr("src",e),void 0===l.Utilities.player?(l.Utilities.video=new o.VideoPlayer,l.Utilities.player=l.Utilities.video.player):(l.Utilities.player.src({type:"video/mp4",src:e}),l.Utilities.player.load()),this.showVideoContainer()}},{key:"showVideoContainer",value:function(){(0,r.default)("#"+this.config.videoId).parent().fadeIn()}},{key:"generateConnectionId",value:function(){var e=new Date;return btoa(unescape(encodeURIComponent(e.getTime()+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)))).slice(0,-2)}}]),e}();e.exports=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoPlayer=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=l(i(4)),r=i(0),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}t.VideoPlayer=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this.lastSeekValue=0,this.videoSeeking=0,this.notifyPeers=!0,this.player=(0,o.default)("my-video",{},this.onPlayerReady.bind(this)),this.addNewButton({id:"addSubsBtn",icon:"icon-speech",title:"Add subtitle"},this.onAddSubBtnClicked.bind(this))}return n(e,[{key:"addNewButton",value:function(e,t){this.player;var i,n,o=document.createElement("div"),r=document.createElement("a");return o.id=e.id,o.className="vjs-custom-icon vjs-control",r.innerHTML="<i title='"+e.title+"' class='icon "+e.icon+" line-height' aria-hidden='true'></i>",o.appendChild(r),i=document.getElementsByClassName("vjs-control-bar")[0],n=document.getElementsByClassName("vjs-fullscreen-control")[0],i.insertBefore(o,n),void 0!==t&&(o.onclick=t),o}},{key:"onAddSubBtnClicked",value:function(){var e=$("<input/>").attr("type","file").attr("accept",".vtt,.srt");e.change(this.onSubChanged.bind(this)),e.trigger("click")}},{key:"onSubChanged",value:function(e){var t,i=e.target.files[0],n=i.name.slice(-3);"srt"==n?this.setSrtSubtitle(i):"vtt"==n?(t=window.URL.createObjectURL(i),this.setSubtitle(t)):r.Utilities.notifyError("Only .srt and .vtt files are supported as subtitles")}},{key:"setSubtitle",value:function(e){for(var t=this.player.remoteTextTracks(),i=t.length;i--;)this.player.removeRemoteTextTrack(t[i]);this.player.addRemoteTextTrack({src:e,kind:"captions",label:"captions on"}),this.player.remoteTextTracks()[0].mode="showing"}},{key:"setSrtSubtitle",value:function(e){var t=this;new s.default(e).getURL().then(function(e){t.setSubtitle(e)}).catch(function(e){r.Utilities.notifyError("Selected .srt file seems to be invalid"),console.error(e)})}},{key:"onPlayerReady",value:function(){r.Utilities.log("Your player is ready!"),this.player.on("seeking",function(e){this.videoSeeking=!0,r.Utilities.log("Video seeking: "+this.player.currentTime())}.bind(this)),this.player.on("pause",function(e){var t={name:r.Utilities.session_identifier,key:"pause",value:!0};this.notifyPeers&&(r.Utilities.log("Video paused","Sending socket message"),r.Utilities.logging&&console.log(t),r.Utilities.websocket.send(JSON.stringify(t))),this.notifyPeers=!0}.bind(this)),this.player.on("play",function(){if(!this.videoSeeking){var e={name:r.Utilities.session_identifier,key:"play",value:!0};this.notifyPeers&&(r.Utilities.log("Video played","Sending socket message"),r.Utilities.logging&&console.log(e),r.Utilities.websocket.send(JSON.stringify(e))),this.notifyPeers=!0}}.bind(this)),this.player.on("seeked",function(e){this.videoSeeking=!1;var t=this.player.currentTime();if(t!=this.lastSeekValue){r.Utilities.log("Video seeked");var i={name:r.Utilities.session_identifier,key:"seek_value",value:{time:t,play:!this.player.paused()}};this.lastSeekValue=t,this.notifyPeers&&(r.Utilities.log("Sending seeked singal message"),r.Utilities.logging&&console.log(i),r.Utilities.websocket.send(JSON.stringify(i))),this.notifyPeers=!0}}.bind(this))}}]),e}()},function(e,t){e.exports=videojs},function(e,t,i){"use strict";i.r(t);class n{constructor(e){this.resource=e}blobToBuffer(){return new Promise((e,t)=>{const i=new FileReader;i.addEventListener("loadend",t=>{const i=t.target.result;e(new Uint8Array(i))}),i.addEventListener("error",()=>t("Error while reading the Blob object")),i.readAsArrayBuffer(this.resource)})}static blobToString(e,t,i){const n=new FileReader;n.addEventListener("loadend",e=>{const i=e.target.result;t(i)}),n.addEventListener("error",()=>i()),n.readAsText(e)}static toVTT(e){return e.replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").concat("\r\n\r\n")}static toTypedArray(e){const t=[];return e.split("").forEach(e=>{t.push(parseInt(e.charCodeAt(),16))}),Uint8Array.from(t)}getURL(){return new Promise((e,t)=>this.resource instanceof Blob?FileReader?TextDecoder?n.blobToString(this.resource,t=>{const i="WEBVTT FILE\r\n\r\n".concat(n.toVTT(t)),o=new Blob([i],{type:"text/vtt"});return this.objectURL=URL.createObjectURL(o),e(this.objectURL)},()=>{this.blobToBuffer().then(t=>{const i=new TextDecoder("utf-8").decode(t),o="WEBVTT FILE\r\n\r\n".concat(n.toVTT(i)),r=new Blob([o],{type:"text/vtt"});return this.objectURL=URL.createObjectURL(r),e(this.objectURL)})}):t("No TextDecoder constructor found"):t("No FileReader constructor found"):t("Expecting resource to be a Blob but something else found."))}release(){URL.createObjectURL(this.objectURL)}}window.WebVTTConverter=n,t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(i(1)),o=i(0);var r=t.Socket=function(e,t){this.wsUri="ws://"+e+":"+t,this.websocket=new WebSocket(this.wsUri),this.msgBox=(0,n.default)("#log"),this.websocket.onopen=this.onConnected.bind(this),this.websocket.onmessage=this.onMessage,this.websocket.onerror=this.onError.bind(this),this.websocket.onclose=this.onError.bind(this)};r.prototype.onConnected=function(e){this.msgBox.html('<div class="system_msg" style="color:#bbbbbb">Socket connected, Connection id: '+o.Utilities.session_identifier+"</div>")},r.prototype.onMessage=function(e){var t=JSON.parse(e.data);t.name!=o.Utilities.session_identifier&&o.Utilities.video&&(o.Utilities.video.notifyPeers=!1,o.Utilities.log("Socket message received:",o.Utilities.video.notifyPeers),o.Utilities.logging&&console.log(t),"seek_value"==t.key?(o.Utilities.player.currentTime(t.value.time),t.value.play&&o.Utilities.player.play()):"pause"!=t.key||o.Utilities.player.paused()?"play"==t.key&&o.Utilities.player.paused()?o.Utilities.player.play():o.Utilities.video.notifyPeers=!0:o.Utilities.player.pause())},r.prototype.onError=function(e){this.msgBox.html('<div class="system_msg" style="color:red">Socket connection lost/failed! reload the page to retry...</div>')}},function(e,t){}]);